# GitHub Secrets Configuration Guide

This guide helps you configure the required GitHub secrets for Azure deployment.

## ğŸ” Required GitHub Secrets

### For Django Backend (Azure Web App)

These secrets are **automatically created** by Azure when you set up deployment center:

1. `AZUREAPPSERVICE_CLIENTID_...` (auto-generated)
2. `AZUREAPPSERVICE_TENANTID_...` (auto-generated)
3. `AZUREAPPSERVICE_SUBSCRIPTIONID_...` (auto-generated)

### For Vue Frontend (Azure Static Web Apps)

You need to **manually add** this secret:

1. `AZURE_STATIC_WEB_APPS_API_TOKEN`
   - Get from: Azure Portal â†’ Your Static Web App â†’ **Manage deployment token**
   - Copy the token and add to GitHub Secrets

### Optional Secrets (for custom configuration)

2. `VITE_API_BASE_URL` (optional)
   - Default: `https://cpsu-health-assistant-backend.azurewebsites.net/api`
   - Override if using custom backend URL

3. `VITE_RASA_URL` (optional)
   - Only needed if deploying Rasa chatbot separately

## ğŸ“ How to Add GitHub Secrets

### Step-by-Step Instructions

1. Go to your GitHub repository
2. Click **Settings** (top navigation)
3. Click **Secrets and variables** â†’ **Actions** (left sidebar)
4. Click **New repository secret** (green button)
5. Enter:
   - **Name**: `AZURE_STATIC_WEB_APPS_API_TOKEN` (or other secret name)
   - **Secret**: [paste your value]
6. Click **Add secret**

### Screenshot Guide

```
GitHub Repository
â””â”€â”€ Settings
    â””â”€â”€ Secrets and variables
        â””â”€â”€ Actions
            â”œâ”€â”€ New repository secret
            â”‚   â”œâ”€â”€ Name: AZURE_STATIC_WEB_APPS_API_TOKEN
            â”‚   â””â”€â”€ Secret: ****************************
            â””â”€â”€ Update secret (for existing secrets)
```

## âœ… Verification Checklist

After adding secrets, verify:

- [ ] Backend deployment secrets exist (auto-created by Azure)
- [ ] `AZURE_STATIC_WEB_APPS_API_TOKEN` added manually
- [ ] All secret names match exactly (case-sensitive)
- [ ] No trailing spaces in secret values
- [ ] Secrets are accessible by GitHub Actions workflows

## ğŸ” Testing Secrets

### Test Backend Secrets

1. Go to **Actions** tab in GitHub
2. Select **Deploy Django Backend to Azure Web App** workflow
3. Click **Run workflow** â†’ **Run workflow**
4. If successful, secrets are configured correctly

### Test Frontend Secrets

1. Go to **Actions** tab in GitHub
2. Select **Deploy Vue Frontend to Azure Static Web Apps** workflow
3. Click **Run workflow** â†’ **Run workflow**
4. If successful, secrets are configured correctly

## ğŸš¨ Troubleshooting

### "Secret not found" Error

**Problem**: Workflow fails with "secret not found"

**Solution**:
1. Verify secret name matches exactly (case-sensitive)
2. Check secret is added to repository (not organization)
3. Ensure workflow has access to secrets:
   ```yaml
   permissions:
     contents: read
     id-token: write
   ```

### "Invalid deployment token" Error

**Problem**: Static Web App deployment fails

**Solution**:
1. Get a fresh token from Azure Portal
2. Delete old secret in GitHub
3. Add new secret with fresh token
4. Retry deployment

### "Authentication failed" Error

**Problem**: Backend deployment fails with auth error

**Solution**:
1. Delete existing Azure deployment workflow in GitHub
2. Reconfigure Deployment Center in Azure Portal
3. Azure will regenerate secrets automatically
4. Retry deployment

## ğŸ”„ Rotating Secrets

### When to Rotate

- Every 90 days (recommended)
- When a team member with access leaves
- If secret is suspected to be compromised
- After a security audit

### How to Rotate

1. **Backend Secrets** (auto-generated by Azure):
   - In Azure Portal, go to Web App â†’ **Deployment Center**
   - Click **Disconnect**
   - Reconnect GitHub (creates new secrets)

2. **Frontend Token**:
   - In Azure Portal, go to Static Web App â†’ **Manage deployment token**
   - Click **Reset token**
   - Update GitHub secret with new token

3. **Custom Secrets**:
   - In GitHub, go to **Settings** â†’ **Secrets** â†’ **Actions**
   - Click secret name â†’ **Update secret**
   - Enter new value â†’ **Update secret**

## ğŸ“‹ Secret Values Reference

### Where to Find Secret Values

| Secret | Where to Find |
|--------|---------------|
| `AZUREAPPSERVICE_CLIENTID_*` | Auto-created by Azure Deployment Center |
| `AZUREAPPSERVICE_TENANTID_*` | Auto-created by Azure Deployment Center |
| `AZUREAPPSERVICE_SUBSCRIPTIONID_*` | Auto-created by Azure Deployment Center |
| `AZURE_STATIC_WEB_APPS_API_TOKEN` | Azure Portal â†’ Static Web App â†’ Manage deployment token |
| `VITE_API_BASE_URL` | Your backend URL (e.g., `https://your-app.azurewebsites.net/api`) |

## ğŸ”’ Security Best Practices

1. âœ… **Never commit secrets to Git**
   - Check `.gitignore` includes `.env` files
   - Use `git secret` or `git-crypt` if needed

2. âœ… **Use environment-specific secrets**
   - Separate secrets for dev/staging/prod
   - Use GitHub Environments for protection rules

3. âœ… **Limit secret access**
   - Only grant access to necessary team members
   - Use Azure Managed Identities when possible

4. âœ… **Monitor secret usage**
   - Review GitHub Actions logs regularly
   - Set up alerts for failed deployments

5. âœ… **Rotate regularly**
   - Set calendar reminders for secret rotation
   - Document rotation procedures

## ğŸ“ Support

If you need help:
1. Check [Azure Deployment Guide](./AZURE_DEPLOYMENT_GUIDE.md)
2. Review GitHub Actions logs for detailed errors
3. Consult Azure documentation
4. Contact your DevOps team

---

**Last Updated**: February 2026
